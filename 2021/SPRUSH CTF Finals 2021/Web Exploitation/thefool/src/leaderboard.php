<?php

session_start();
require_once "config.inc.php";

if (isset($_POST['logout'])){
    session_destroy();
    header("Location: index.php");
    die();
}

?>
<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>Durak - Card game</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<script src="js/jquery.js"></script>
<script src="js/animation.js"></script>
</head>

<div class="topnav">
  <a href="/index.php">Home</a>
  <a class="active" href="/leaderboard.php">Leaderboard</a>
<?php
if (empty($_SESSION)){
  $output .= '  <div class="login-container">';
  $output .= '    <form action="/login.php" method="post">';
  $output .= '      <input type="text" placeholder="Username" name="username">';
  $output .= '      <input type="text" placeholder="Password" name="password">';
  $output .= '      <button class="button" name="type" value="login" type="submit">Login</button>';
  $output .= '      <button class="button" name="type" value="register" type="submit">Register</button>';
  $output .= '    </form>';
  $output .= '  </div>';
} else {
  $output .= '  <div class="login-container">';
  $output .= '    <form action="/login.php" method="post">';
  $output .= '      <button name="logout" value="logout" type="submit">Logout</button>';
  $output .= '    </form>';
  $output .= '  </div>';
}
echo $output;
?>
</div>

<form name="description" action="index.php" method="get" id="start-form">
<div><h1>Leaderboard</h1></div>
<div><img src="images/deck-of-cards.png"></div>

<?php
	$sth = $conn->prepare("SELECT totalgames FROM games");
	$sth->execute();
	$games = $sth->fetchAll(PDO::FETCH_OBJ)[0]->totalgames;
?>

<b>Total games played:</b> <?php echo $games; ?>
<div class="description"><br>
<table border="1" align="center" bgcolor="#383838"  width="100%">
<tr>
 <th>User</th>
 <th>wins</th>
</tr>

<?php
$sth = $conn->prepare("SELECT * FROM users");
$sth->execute();
$users = $sth->fetchAll(PDO::FETCH_OBJ);

foreach ($users as $user){
  echo '<tr><td>' . $user->login . '</td><td>' . $user->wins . '</td></tr>';
}
?>
</tr>
</table>
