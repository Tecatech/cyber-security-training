<?php
  session_start();
  require_once "config.inc.php";
  include_once 'classes/Desk.php';
  if (!$_SESSION['game_started']){
    header("Location: /?errors[]=Game+not+started!");
    exit();
  }

  if (empty($_SESSION['desk'])){

    $desk = new Desk();
    $desk->startTheGame();
    echo $desk->renderHeader();
    $desk->renderForm();
    echo $desk->renderFooter();
    $_SESSION['desk'] = serialize($desk);

  } else {
    $desk = unserialize($_SESSION['desk']);

    if (empty($_SESSION['gameWinner'])) {
        $desk->continueTheGame();
        echo $desk->renderHeader();
        $desk->renderForm();
        echo $desk->renderFooter();
    } else {

        unset($_COOKIE['Player']);
        setcookie('Player', null, -1, '/');

        echo $desk->renderHeader();
        echo $desk->renderGameFinish();
        echo $desk->renderFooter();

        unset($_SESSION['PackOfCards']);
        unset($_SESSION['opponent']);
        unset($_SESSION['desk']);
        unset($_SESSION['gameWinner']);
    }

  }

?>
